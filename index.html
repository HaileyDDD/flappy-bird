<!DOCTYPE html>
<html>
<head>
  <title>Flappy Bird Diagnostic</title>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    #diagnostic-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="diagnostic-panel">
    <div id="browser-info">浏览器检测中...</div>
    <div id="phaser-info">Phaser检测中...</div>
    <div id="game-status">游戏状态：未初始化</div>
  </div>
  <div id="game-container"></div>

  <script>
    // 浏览器兼容性检测
    function detectBrowserInfo() {
      const info = document.getElementById('browser-info');
      info.innerHTML = `
        浏览器: ${navigator.userAgent}
        WebGL支持: ${!!window.WebGLRenderingContext}
        Canvas支持: ${!!document.createElement('canvas').getContext}
      `;
    }

    // Phaser诊断
    function diagnosticPhaser() {
      const phaserInfo = document.getElementById('phaser-info');
      const gameStatus = document.getElementById('game-status');

      if (typeof Phaser === 'undefined') {
        phaserInfo.innerHTML = 'Phaser加载失败';
        return false;
      }

      phaserInfo.innerHTML = `Phaser版本: ${Phaser.VERSION}`;
      return true;
    }

    // 游戏场景诊断
    class DiagnosticScene extends Phaser.Scene {
      constructor() {
        super('DiagnosticScene');
      }

      preload() {
        this.load.image('diagnostic_bird', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==');
      }

      create() {
        const gameStatus = document.getElementById('game-status');
        gameStatus.innerHTML = '游戏场景创建成功';

        const bird = this.add.sprite(100, 100, 'diagnostic_bird');
        
        this.input.keyboard.on('keydown-SPACE', () => {
          gameStatus.innerHTML = '键盘事件正常';
        });
      }
    }

    function initGame() {
      detectBrowserInfo();
      
      if (!diagnosticPhaser()) {
        return;
      }

      const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: 'game-container',
        scene: DiagnosticScene
      };

      try {
        new Phaser.Game(config);
      } catch (error) {
        const gameStatus = document.getElementById('game-status');
        gameStatus.innerHTML = `游戏初始化错误: ${error.message}`;
      }
    }

    window.onload = initGame;
  </script>
</body>
</html> 